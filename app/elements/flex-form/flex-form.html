<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../elements.html">
<link rel="import" href="../../include.html">

<dom-module id="flex-form">
  <template>
    <style>
      :host {
        display: block;
      }
      span {
        @apply(--paper-font-body1);
      }
      paper-material {
        border-radius: 2px;
        height: 100%;
        padding: 16px;
        width: calc(98.66% - 16px);
        margin: 16px auto;
        background: var(--paper-indigo-50);
      }
      .header {
        @apply(--layout-horizontal);
        color: var(--secondary-text-color);
      }
      .space {
        @apply(--layout-flex);
      }
      paper-icon-button {
        color: var(--accent-color);
      }
    </style>

    <template is="dom-repeat" items="{{tables}}">
      <paper-material elevation="1">
        <div class="header">
          <h1>{{item.name}}</h1>
          <span class="space"></span>
          <paper-icon-button icon="add" alt="New"></paper-icon-button>
          <paper-icon-button icon="clear" alt="Drop"></paper-icon-button>
          <template is="dom-if" if="{{item.expand}}">
            <paper-icon-button icon="expand-less" alt="Less"></paper-icon-button>
          </template>
          <template is="dom-if" if="{{!item.expand}}">
            <paper-icon-button icon="expand-more" alt="More"></paper-icon-button>
          </template>
        </div>
        <template is="dom-repeat" items="{{item.data}}">
          <paper-material elevation="2">
            <template is="dom-if" if="{{isObject(item.v)}}">
              <div class="header">
                <h4>{{item.k}} : </h4>
                <span class="space"></span>
                <paper-icon-button icon="add" alt="New"></paper-icon-button>
                <paper-icon-button icon="clear" alt="Drop"></paper-icon-button>
                <template is="dom-if" if="{{item.expand}}">
                  <paper-icon-button icon="expand-less" alt="Less"></paper-icon-button>
                </template>
                <template is="dom-if" if="{{!item.expand}}">
                  <paper-icon-button icon="expand-more" alt="More"></paper-icon-button>
                </template>
              </div>
              <template is="dom-repeat" items="{{item.v}}">
                <paper-material elevation="3">
                  <template is="dom-if" if="{{isObject(item.v)}}">
                    <div class="header">
                      <h4>{{item.k}} : </h4>
                      <span class="space"></span>
                      <paper-icon-button icon="add" alt="New"></paper-icon-button>
                      <paper-icon-button icon="clear" alt="Drop"></paper-icon-button>
                      <template is="dom-if" if="{{item.expand}}">
                        <paper-icon-button icon="expand-less" alt="Less"></paper-icon-button>
                      </template>
                      <template is="dom-if" if="{{!item.expand}}">
                        <paper-icon-button icon="expand-more" alt="More"></paper-icon-button>
                      </template>
                    </div>
                    <template is="dom-repeat" items="{{item.v}}">
                      <paper-material elevation="4">
                        <div class="header">
                          <span>{{item.k}} : </span>
                          <span class="space"></span>
                          <paper-icon-button icon="clear" alt="Drop"></paper-icon-button>
                        </div>
                        <paper-input label="Default Value" value="{{item.v}}"></paper-input>
                      </paper-material>
                    </template>
                  </template>
                  <template is="dom-if" if="{{!isObject(item.v)}}">
                    <div class="header">
                      <span>{{item.k}} : </span>
                      <span class="space"></span>
                      <paper-icon-button icon="clear" alt="Drop"></paper-icon-button>
                    </div>
                    <paper-input label="Default Value" value="{{item.v}}"></paper-input>
                  </template>
                </paper-material>
              </template>
            </template>
            <template is="dom-if" if="{{!isObject(item.v)}}">
              <div class="header">
                <span>{{item.k}} : </span>
                <span class="space"></span>
                <paper-icon-button icon="clear" alt="Drop"></paper-icon-button>
              </div>
              <paper-input label="Default Value" value="{{item.v}}"></paper-input>
            </template>
          </paper-material>
        </template>
        <pre>{{item.schema}}</pre>
      </paper-material>
    </template>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'flex-form',

        properties: {
          tables: {
            type: Array,
            value: [],
            notify: true
          }
        },

        ready: function() {
          flexModel.on('table-schema', 'value', data=>{
            data.forEach(e=>{
              this.push('tables', {name: e.key, data: flexTools.json2array(e.data), schema: JSON.stringify(e.data, null, 2)});
            });
          });
        },

        isObject: function(tgt) {
          return typeof tgt == 'object';
        }
      });
    })();
  </script>
</dom-module>
